<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>HackoAI â€¢ OG V3</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root{
  --bg:#020617;
  --panel:#020617ee;
  --text:#e5e7eb;
  --accent:#22d3ee;
  --border:#1f2937;
}
.light{
  --bg:#f8fafc;
  --panel:#ffffff;
  --text:#020617;
  --accent:#0ea5e9;
  --border:#cbd5e1;
}
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  height:100vh;
  display:flex;
}
#sidebar{
  width:220px;
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:10px;
  display:flex;
  flex-direction:column;
}
#sidebar button{
  background:var(--accent);
  border:none;
  color:#000;
  padding:8px;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
}
.chatItem{
  margin-top:8px;
  padding:8px;
  border-radius:8px;
  cursor:pointer;
  border:1px solid var(--border);
}
.chatItem:hover{background:rgba(255,255,255,.05)}

#app{
  flex:1;
  display:flex;
  flex-direction:column;
}
header{
  padding:10px;
  display:flex;
  justify-content:space-between;
  border-bottom:1px solid var(--border);
}
#chat{
  flex:1;
  overflow-y:auto;
  padding:20px;
}
.msg{
  margin-bottom:14px;
  line-height:1.5;
}
.user{color:var(--accent)}
.bot{color:var(--text)}

#loaderBar{
  height:3px;
  background:linear-gradient(90deg,var(--accent),transparent);
  animation:load 1s linear infinite;
}
@keyframes load{
  from{background-position:0}
  to{background-position:200px}
}

.spinner{
  width:22px;height:22px;
  border:3px solid var(--border);
  border-top-color:var(--accent);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

footer{
  padding:10px;
  border-top:1px solid var(--border);
  display:flex;
  gap:8px;
}
textarea{
  flex:1;
  resize:none;
  height:42px;
  border-radius:10px;
  padding:10px;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
  overflow:hidden;
}
button {
  transition: background .15s ease, transform .1s ease, opacity .1s ease;
}

button:hover {
  opacity: .9;
}

button:active {
  transform: scale(0.97);
}

button:focus-visible {
  outline: 2px solid var(--user);
  outline-offset: 2px;
}

</style>
</head>

<body>
<div id="sidebar">
  <button onclick="newChat()">ï¼‹ New Chat</button>
  <div id="chatList"></div>
</div>

<div id="app">
<header>
  <div>âš¡ HackoAI OG V3</div>
  <button onclick="toggleTheme()">ðŸŒ“</button>
</header>

<div id="loaderBar" hidden></div>
<div id="chat"></div>

<footer>
  <textarea id="input" placeholder="Say somethingâ€¦"></textarea>
  <button onclick="send()">Send</button>
</footer>
</div>

<script>
/* ================= STORAGE ================= */
const STORE_KEY="hackoai_v3";
let store=JSON.parse(localStorage.getItem(STORE_KEY))||{
  sessions:{},
  active:null,
  theme:"dark"
};
document.body.classList.toggle("light",store.theme==="light");

function saveStore(){
  localStorage.setItem(STORE_KEY,JSON.stringify(store));
}

/* ================= CHAT CORE ================= */
const chat=document.getElementById("chat");
const input=document.getElementById("input");

function render(role,content,saveIt=true){
  const div=document.createElement("div");
  div.className="msg "+role;
  chat.appendChild(div);
  if(role==="bot") type(div,content);
  else div.textContent=content;
  chat.scrollTop=chat.scrollHeight;
  if(saveIt) save(role,content);
  return div;
}

function type(el,text){
  let i=0;
  const t=setInterval(()=>{
    el.textContent+=text[i++];
    if(i>=text.length) clearInterval(t);
  },15);
}

function save(role,content){
  const s=store.sessions[store.active];
  if(!s) return;
  s.messages.push({role,content});
  saveStore();
}

/* ================= SEND ================= */
async function send() {
  let prompt = input.value.trim();
  if (!prompt) return;
  input.value = "";

  render("user", prompt);

  const loading = render("bot", "<div class='spinner'></div>", false);

  try {
    const res = await fetch("/.netlify/functions/hackoAI", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text: prompt })
    });

    const data = await res.json();

    loading.remove();

    const answer = data?.choices?.[0]?.message?.content;

    if (!answer) {
      render("bot", "ðŸ’€ Empty response. Free-tier moment.");
      return;
    }

    streamBot(answer);

  } catch (err) {
    loading.remove();
    console.error(err);
    render("bot", "**Network error. Server folded ðŸ’€**");
  }
}
/* ================= SESSIONS ================= */
function newChat(){
  const id="chat_"+Date.now();
  store.sessions[id]={name:"New Chat",messages:[]};
  store.active=id;
  saveStore();
  loadChat(id);
  renderSidebar();
}
function loadChat(id){
  chat.innerHTML="";
  store.active=id;
  store.sessions[id].messages.forEach(m=>render(m.role,m.content,false));
  saveStore();
}
function renderSidebar(){
  const list=document.getElementById("chatList");
  list.innerHTML="";
  Object.entries(store.sessions).forEach(([id,c])=>{
    const d=document.createElement("div");
    d.className="chatItem";
    d.textContent=c.name;
    d.onclick=()=>loadChat(id);
    d.ondblclick=()=>{
      const n=prompt("Rename chat",c.name);
      if(n){c.name=n;saveStore();renderSidebar();}
    };
    list.appendChild(d);
  });
}

/* ================= THEME ================= */
function toggleTheme(){
  store.theme=store.theme==="dark"?"light":"dark";
  document.body.classList.toggle("light",store.theme==="light");
  saveStore();
}

/* ================= INIT ================= */
if(!store.active) newChat();
else loadChat(store.active);
renderSidebar();
/* ================= SEND ================= */
  input.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault(); // stop newline
    send();
  }
});

</script>
</body>
</html>



